@using Microsoft.AspNetCore.Identity;
@inject SignInManager<Usuario> SignInManager

@model Livraria.Models.Livro

@{
	ViewData["Title"] = "Details";
	string IdUsuario = ViewData["IdUsuario"] as string;
	bool? vendedor = ViewData["Vendedor"] as bool?;
}
<div class="book-details-page">
	<div class="book-details">
		<div class="book-cover">
			<img src="@Model.Capa" alt="Capa do Livro: @Model.Nome">
		</div>
		<div class="book-info">
			<h2>@Model.Nome</h2>
			<p>Autor: <strong>@Model.Autor</strong></p>
			<p>Preço: <strong>R$ @Model.Preco</strong></p>
			<p>Vendas: @Model.QtdVendas</p>

			@if (SignInManager.IsSignedIn(User))
			{
				<a class="btn btn-style">Adicionar ao carrinho</a>
			}
			else
			{
				<a class="btn btn-style" asp-area="Identity" asp-page="/Account/Login">Adicionar ao carrinho</a>
			}

			<div class="rating-section">
				<h3>Avaliações:</h3>
				@if (Model.Avaliacoes != null)
				{
					foreach (var avaliacao in Model.Avaliacoes)
					{
						<div class="rating">
							<p>Usuário: @avaliacao.Avaliador.Nome</p>
							<p>Avaliação: @avaliacao.Estrelas estrelas</p>
							<p>Comentário: @avaliacao.Comentario</p>
						</div>

						@if (SignInManager.IsSignedIn(User))
						{
							if (vendedor != null)
							{
								if (vendedor == true)
								{
									<form asp-action="Delete" asp-route-id="@avaliacao.Id" asp-controller="Avaliacaos" method="POST">
										<button type="submit" class="btn btn-danger">Remover Avaliação</button>
									</form>
								}
							}
						}
					}
				}
			</div>
		</div>
	</div>
	<hr />
	@if (SignInManager.IsSignedIn(User))
	{
		if (vendedor == true)
		{
			<div class="submit-rating">
				<h3>Vendedores não avaliam livros</h3>
			</div>
		}
		else
		{
			<div class="submit-rating">
				<h3>Faça a sua avaliação</h3>
				<form asp-action="AdicionarAvaliacao" asp-route-id="@Model.Id" method="post">
					<input type="hidden" name="IdLivro" value="@Model.Id" />
					<input type="hidden" name="IdUsuario" value="@IdUsuario" />

					<div class="stars">
						@for (int i = 1; i <= 5; i++)
						{
							<input type="radio" name="Estrelas" id="star-@i" value="@i" />
							<label for="star-@i">&#9733;</label>
						}
					</div>

					<textarea class="form-control" name="Comentario" placeholder="Adicione um comentário..."></textarea>
					<button type="submit" class="btn btn-style">Enviar avaliação</button>
				</form>
			</div>
		}
	}
	else
	{
		<div class="submit-rating">
			<h3>Você precisa estar logado para avaliar esse livro!</h3>
		</div>
	}
</div>

@*<div>
	<a asp-action="Edit" asp-route-id="@Model?.Id">Edit</a> |
	<a asp-action="Index">Back to List</a>
</div>*@
